<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



















  
  
  
  

  
    
    
  

  
    
      
    

    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
    
    <link href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Noto Serif SC:300,300italic,400,400italic,700,700italic|Noto Serif SC:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.5.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.5.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.5.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="一. TCP协议1. 三次握手TCP/IP协议中, TCP协议提供可靠的连接服务, 采用三次握手建立一个连接, 如图1所示.   第一次握手: 建立连接时, 客户端A发送SYN包(SYN=j)到服务器B, 并进入SYN_SEND状态, 等待服务器B确认.  第二次握手: 服务器B收到SYN包, 必须确认客户A的SYN(ACK=j+1), 同时自己也发送一个SYN包(SYN=k), 即SYN+ACK">
<meta name="keywords" content="面试,网络">
<meta property="og:type" content="article">
<meta property="og:title" content="面试汇总-网络">
<meta property="og:url" content="http://yoursite.com/2021/02/13/面试汇总-网络/index.html">
<meta property="og:site_name" content="flyfish&#39;s blog">
<meta property="og:description" content="一. TCP协议1. 三次握手TCP/IP协议中, TCP协议提供可靠的连接服务, 采用三次握手建立一个连接, 如图1所示.   第一次握手: 建立连接时, 客户端A发送SYN包(SYN=j)到服务器B, 并进入SYN_SEND状态, 等待服务器B确认.  第二次握手: 服务器B收到SYN包, 必须确认客户A的SYN(ACK=j+1), 同时自己也发送一个SYN包(SYN=k), 即SYN+ACK">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2021/02/13/面试汇总-网络/TCPConnect.JPG">
<meta property="og:image" content="http://yoursite.com/2021/02/13/面试汇总-网络/08-59-13.jpg">
<meta property="og:image" content="http://yoursite.com/2021/02/13/面试汇总-网络/20150419112344942">
<meta property="og:image" content="http://yoursite.com/2021/02/13/面试汇总-网络/20150419131338193">
<meta property="og:image" content="http://yoursite.com/2021/02/13/面试汇总-网络/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcwNzAxMTE1MzUyMjgx">
<meta property="og:image" content="http://yoursite.com/2021/02/13/面试汇总-网络/20150419131338193">
<meta property="og:image" content="http://yoursite.com/2021/02/13/面试汇总-网络/14158ca87e2f341ff044efd967f3e008.png">
<meta property="og:image" content="http://yoursite.com/2021/02/13/面试汇总-网络/08e6235892053a81603a4c3d7c7f44ad.png">
<meta property="og:updated_time" content="2021-10-23T01:39:07.179Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="面试汇总-网络">
<meta name="twitter:description" content="一. TCP协议1. 三次握手TCP/IP协议中, TCP协议提供可靠的连接服务, 采用三次握手建立一个连接, 如图1所示.   第一次握手: 建立连接时, 客户端A发送SYN包(SYN=j)到服务器B, 并进入SYN_SEND状态, 等待服务器B确认.  第二次握手: 服务器B收到SYN包, 必须确认客户A的SYN(ACK=j+1), 同时自己也发送一个SYN包(SYN=k), 即SYN+ACK">
<meta name="twitter:image" content="http://yoursite.com/2021/02/13/面试汇总-网络/TCPConnect.JPG">






  <link rel="canonical" href="http://yoursite.com/2021/02/13/面试汇总-网络/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>面试汇总-网络 | flyfish's blog</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title"><i class="fa fa-bookmark-o"></i>&nbsp;flyfish's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">

    
    
    
      
    

    

    <a href="/have-fun.html" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>元素周期表</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/13/面试汇总-网络/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="flyfish">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/default.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="flyfish's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">面试汇总-网络
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-02-13 15:14:53" itemprop="dateCreated datePublished" datetime="2021-02-13T15:14:53+08:00">2021-02-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-10-23 09:39:07" itemprop="dateModified" datetime="2021-10-23T09:39:07+08:00">2021-10-23</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/面试/" itemprop="url" rel="index"><span itemprop="name">面试</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="一-TCP协议"><a href="#一-TCP协议" class="headerlink" title="一. TCP协议"></a>一. TCP协议</h2><h3 id="1-三次握手"><a href="#1-三次握手" class="headerlink" title="1. 三次握手"></a>1. 三次握手</h3><p>TCP/IP协议中, TCP协议提供可靠的连接服务, 采用三次握手建立一个连接, 如图1所示. </p>
<ol>
<li>第一次握手: 建立连接时, 客户端A发送SYN包(SYN=j)到服务器B, 并进入SYN_SEND状态, 等待服务器B确认. </li>
<li>第二次握手: 服务器B收到SYN包, 必须确认客户A的SYN(ACK=j+1), 同时自己也发送一个SYN包(SYN=k), 即SYN+ACK包, 此时服务器B进入SYN_RECV状态. </li>
<li>第三次握手: 客户端A收到服务器B的SYN＋ACK包, 向服务器B发送确认包ACK(ACK=k+1), 此包发送完毕, 客户端A和服务器B进入ESTABLISHED状态, 完成三次握手. </li>
</ol>
<p>完成三次握手, 客户端与服务器开始传送数据.<br><code>确认号</code>: 其数值等于发送方的发送序号 +1(即接收方期望接收的下一个序列号). </p>
<p><img src="/2021/02/13/面试汇总-网络/./TCPConnect.JPG" alt="enter image description here"></p>
<h3 id="2-四次挥手"><a href="#2-四次挥手" class="headerlink" title="2. 四次挥手"></a>2. 四次挥手</h3><p>TCP的连接的拆除需要发送四个包, 因此称为四次挥手(four-way handshake). 客户端或服务器均可主动发起挥手动作, 在socket编程中, 任何一方执行close()操作即可产生挥手操作. </p>
<ol>
<li>客户端A发送一个FIN, 用来关闭客户A到服务器B的数据传送.  </li>
<li>服务器B收到这个FIN, 它发回一个ACK, 确认序号为收到的序号加1. 和SYN一样, 一个FIN将占用一个序号.  </li>
<li>服务器B关闭与客户端A的连接, 发送一个FIN给客户端A.  </li>
<li>客户端A发回ACK报文确认, 并将确认序号设置为收到序号加1.  </li>
</ol>
<p><img src="/2021/02/13/面试汇总-网络/./08-59-13.jpg" alt="enter image description here"></p>
<h3 id="3-为什么是三次握手和四次挥手？"><a href="#3-为什么是三次握手和四次挥手？" class="headerlink" title="3. 为什么是三次握手和四次挥手？"></a>3. 为什么是三次握手和四次挥手？</h3><h4 id="3-1-为什么是三次握手？"><a href="#3-1-为什么是三次握手？" class="headerlink" title="3.1 为什么是三次握手？"></a>3.1 为什么是三次握手？</h4><blockquote>
<p>三次握手可以简单看做是客户发送请求, 服务器对客户的请求进行确认, 客户对服务器的确认再进行确认.<br>如果采用两次握手, 假设下面这种情况, 客户向服务器发送请求, 服务器没有对客户的请求进行确认(因为网络的延迟他可能没有收到这个请求). 客户收不到这个确认于是过一段时间他在向服务器发起连接请求并顺利完成数据传输, 但是过了一段时间这个请求到达了服务器而服务器误以为这是一个新的连接请求于是对这个请求进行确认并发送确认给客户但是客户没有发起过连接请求因此它不会理会服务器的确认, 服务器以为这个连接已经建立好了于是一直等待客户发送数据, 这样就会造成服务器的资源浪费. 如果采用三次握手上述情况客户不会向服务器的确认进行确认, 这样服务器收不到确认它就知道客户没有要发起请求的连接, 于是不会再等待.<br> 三次握手主要是为了防止已失效的连接请求报文突然到达服务器, 造成服务器的等待和资源的浪费. </p>
</blockquote>
<h4 id="3-2-为什么是四次挥手？"><a href="#3-2-为什么是四次挥手？" class="headerlink" title="3.2 为什么是四次挥手？"></a>3.2 为什么是四次挥手？</h4><blockquote>
<p>在三次握手的过程中, SYN和ACK是一起发送的但是在四次挥手的时候FIN和ACK却不是一起发送的而是分开发送的, 为什么呢？？？那是因为啊, TCP连接是全双工的也就是说接收到FIN只是说没有数据再发过来但是还是可以发送数据的, 也就是接受到一个FIN只是关闭了一个方向的数据传输, 另一个方向还可以继续发送数据. 在四次挥手的时候也是这样前两次挥手只是确认关闭了一个方向的数据, 加上后面两次挥手才真正的关闭了整个全双工连接.<br>当socket在ESTABISHED状态时, 他想主动关闭连接于是向对方发送FIN请求, 发送完FIN请求后它处于FIN_WAIT_1状态, 当对方确认ACK报文后则处于FIN_WAIT_2状态. FIN_WAIT_2表示半连接, 也就是有一方要求关闭连接, 另一方收到请求但是告诉她我还有一些数据要发送稍后会关闭. TIME_WAIT状态表示收到对方的FIN并发送出ACK.如果三次握手可能在关闭后还有一个方向没有关闭.<br>转载自: <a href="http://blog.csdn.net/yangliuhepanpan/article/details/51601221" target="_blank" rel="noopener">为什么是三次握手而不是两次握手为什么是四次挥手</a></p>
</blockquote>
<h3 id="4-深入理解TCP连接的释放"><a href="#4-深入理解TCP连接的释放" class="headerlink" title="4. 深入理解TCP连接的释放"></a>4. 深入理解TCP连接的释放</h3><p>由于TCP连接是全双工的, 因此每个方向都必须单独进行关闭. 这原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接. 收到一个 FIN只意味着这一方向上没有数据流动, 一个TCP连接在收到一个FIN后仍能发送数据. 首先进行关闭的一方将执行主动关闭, 而另一方执行被动关闭.<br>TCP协议的连接是全双工连接, 一个TCP连接存在双向的读写通道.<br>简单说来是 “先关读, 后关写”, 一共需要四个阶段. 以客户机发起关闭连接为例: </p>
<ol>
<li>服务器读通道关闭</li>
<li>客户机写通道关闭</li>
<li>客户机读通道关闭</li>
<li>服务器写通道关闭<br>关闭行为是在发起方数据发送完毕之后, 给对方发出一个FIN(finish)数据段. 直到接收到对方发送的FIN, 且对方收到了接收确认ACK之后, 双方的数据通信完全结束, 过程中每次接收都需要返回确认数据段ACK. </li>
</ol>
<h4 id="4-1-连接释放详细过程"><a href="#4-1-连接释放详细过程" class="headerlink" title="4.1 连接释放详细过程"></a>4.1 连接释放详细过程</h4><p><strong>第一阶段</strong>   客户机发送完数据之后, 向服务器发送一个FIN数据段, 序列号为i;</p>
<ol>
<li>服务器收到FIN(i)后, 返回确认段ACK, 序列号为i+1, 关闭服务器读通道;</li>
<li>客户机收到ACK(i+1)后, 关闭客户机写通道;</li>
</ol>
<p>此时, 客户机仍能通过读通道读取服务器的数据, 服务器仍能通过写通道写数据,<br><strong>第二阶段</strong> 服务器发送完数据之后, 向客户机发送一个FIN数据段, 序列号为j;</p>
<ol>
<li>客户机收到FIN(j)后, 返回确认段ACK, 序列号为j+1, 关闭客户机读通道;</li>
<li>服务器收到ACK(j+1)后, 关闭服务器写通道.<br>这是标准的TCP关闭两个阶段, <code>服务器和客户机都可以发起关闭</code>, 完全对称. </li>
</ol>
<h3 id="5-TCP连接中出现的各种状态"><a href="#5-TCP连接中出现的各种状态" class="headerlink" title="5. TCP连接中出现的各种状态"></a>5. TCP连接中出现的各种状态</h3><p><code>SYN_RECV</code></p>
<blockquote>
<p>服务端收到建立连接的SYN没有收到ACK包的时候处在SYN_RECV状态. </p>
</blockquote>
<p><code>CLOSE_WAIT</code></p>
<blockquote>
<p>发起TCP连接关闭的一方称为client, 被动关闭的一方称为server. 被动关闭的server收到FIN后, 但未发出ACK的TCP状态是CLOSE_WAIT. 出现这种状况一般都是由于server端代码的问题, 如果你的服务器上出现大量CLOSE_WAIT, 应该要考虑检查代码. </p>
</blockquote>
<p><code>TIME_WAIT</code></p>
<blockquote>
<p>根据TCP协议定义的3次握手断开连接规定,发起socket主动关闭的一方 socket将进入TIME_WAIT状态. TIME_WAIT状态将持续2个MSL(Max Segment Lifetime),在Windows下默认为4分钟, 即240秒. TIME_WAIT状态下的socket不能被回收使用. 具体现象是对于一个处理大量短连接的服务器,如果是由服务器主动关闭客户端的连接, 将导致服务器端存在大量的处于TIME_WAIT状态的socket,  甚至比处于Established状态下的socket多的多,严重影响服务器的处理能力, 甚至耗尽可用的socket, 停止服务.<br><code>TIME_WAIT是TCP协议用以保证被重新分配的socket不会受到之前残留的延迟重发报文影响的机制,是必要的逻辑保证</code></p>
</blockquote>
<p>转载自: <a href="http://www.cnblogs.com/Jessy/p/3535612.html" target="_blank" rel="noopener">TCP的三次握手(建立连接)和四次挥手(关闭连接)</a></p>
<h3 id="6-TCP和UDP的区别"><a href="#6-TCP和UDP的区别" class="headerlink" title="6. TCP和UDP的区别"></a>6. TCP和UDP的区别</h3><ol>
<li>基于连接与无连接</li>
<li>TCP要求系统资源较多, UDP较少</li>
<li>UDP程序结构较简单 </li>
<li>流模式(TCP)与数据报模式(UDP)</li>
<li>TCP保证数据正确性, UDP可能丢包 </li>
<li>TCP保证数据顺序, UDP不保证 </li>
<li>TCP更慢, UDP更快</li>
</ol>
<h3 id="7-TCP如何保证可靠性"><a href="#7-TCP如何保证可靠性" class="headerlink" title="7. TCP如何保证可靠性"></a>7. TCP如何保证可靠性</h3><blockquote>
<p>参考: <a href="https://blog.csdn.net/liuchenxia8/article/details/80428157" target="_blank" rel="noopener">TCP协议-如何保证传输可靠性</a></p>
</blockquote>
<ul>
<li>校验和</li>
<li>序列号</li>
<li>确认应答</li>
<li>超时重传</li>
<li>连接管理</li>
<li>流量控制: 受到接收端窗口大小影响</li>
<li>拥塞控制: 受到网络带宽影响</li>
</ul>
<h3 id="8-慢启动-拥塞避免"><a href="#8-慢启动-拥塞避免" class="headerlink" title="8. 慢启动, 拥塞避免"></a>8. 慢启动, 拥塞避免</h3><p><img src="/2021/02/13/面试汇总-网络/./20150419112344942" alt="enter image description here"><br><img src="/2021/02/13/面试汇总-网络/./20150419131338193" alt="enter image description here"></p>
<ol>
<li>开始发送数据时, 窗口较小</li>
<li>未达到阈值时, 窗口大小以指数级增长</li>
<li>达到阈值时, 窗口大小线性增长</li>
<li>发生超时重传时, 慢启动阈值会变成之前窗口大小的一半, 而此时的窗口大小为初始值. </li>
</ol>
<h3 id="9-快重传和快恢复"><a href="#9-快重传和快恢复" class="headerlink" title="9. 快重传和快恢复"></a>9. 快重传和快恢复</h3><h4 id="9-1-快重传"><a href="#9-1-快重传" class="headerlink" title="9.1 快重传"></a>9.1 快重传</h4><p><img src="/2021/02/13/面试汇总-网络/./aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcwNzAxMTE1MzUyMjgx" alt="enter image description here"></p>
<ol>
<li>要求接收方每收到一个失序的报文段后就立即发出重复确认而不是等待自己发送数据时才捎带确认</li>
<li>发送方只要一连收到三个重复确认就立即重传对方尚未收到的报文段, 而不必等待设置的重传计时器到期</li>
</ol>
<h4 id="9-2-快恢复"><a href="#9-2-快恢复" class="headerlink" title="9.2 快恢复"></a>9.2 快恢复</h4><p><img src="/2021/02/13/面试汇总-网络/./20150419131338193" alt="enter image description here"></p>
<ol>
<li>当发送方连续收到三个重复确认时, 就执行“乘法减小”算法, 把慢开始门限ssthresh减半, 为了预防网络拥塞</li>
<li>将拥塞窗口cwnd值设置为慢开始门限ssthresh减半后的数值, 然后开始执行拥塞避免算法</li>
</ol>
<ul>
<li>TCP Tahoe版本与TCP Reno版本的区别: Reno版本在快重传之后采用快恢复算法而不是采用慢开始算法</li>
</ul>
<h3 id="10-为什么需要TIME-WAIT状态"><a href="#10-为什么需要TIME-WAIT状态" class="headerlink" title="10. 为什么需要TIME_WAIT状态"></a>10. 为什么需要<code>TIME_WAIT</code>状态</h3><ul>
<li>防止延迟的数据段被其他使用相同源地址、源端口、目的地址以及目的端口的 TCP 连接收到;</li>
<li>保证 TCP 连接的远程被正确关闭, 即等待被动关闭连接的一方收到 FIN 对应的 ACK 消息;</li>
</ul>
<p>详情见: <a href="https://draveness.me/whys-the-design-tcp-time-wait/" target="_blank" rel="noopener">为什么 TCP 协议有 TIME_WAIT 状态</a></p>
<h2 id="二-HTTP协议"><a href="#二-HTTP协议" class="headerlink" title="二. HTTP协议"></a>二. HTTP协议</h2><h3 id="1-HTTPS-TLS的握手过程"><a href="#1-HTTPS-TLS的握手过程" class="headerlink" title="1. HTTPS TLS的握手过程"></a>1. HTTPS TLS的握手过程</h3><h4 id="1-1-TLS-单行认证握手"><a href="#1-1-TLS-单行认证握手" class="headerlink" title="1.1 TLS 单行认证握手"></a>1.1 TLS 单行认证握手</h4><p><img src="/2021/02/13/面试汇总-网络/./14158ca87e2f341ff044efd967f3e008.png" alt="enter image description here"></p>
<ol>
<li>客户端给出协议版本号、一个客户端生成的随机数(Client random), 以及客户端支持的加密方法. </li>
<li>服务端确认双方使用的加密方法, 并给出数字证书、以及一个服务器生成的随机数(Server random)</li>
<li>客户端确认数字证书有效, 然后生成一个新的随机数(Premaster secret), 并使用数字证书中的公钥, 加密这个随机数, 发给服务端. </li>
<li>服务端使用自己的私钥, 获取客户端发来的随机数(即Premaster secret). </li>
<li>客户端和服务端根据约定的加密方法, 使用前面的三个随机数, 生成<code>对话密钥</code>(session key), 用来加密接下来的整个对话过程. </li>
</ol>
<h4 id="1-2-为什么需要三个随机数"><a href="#1-2-为什么需要三个随机数" class="headerlink" title="1.2 为什么需要三个随机数"></a>1.2 为什么需要三个随机数</h4><p><strong>增强随机性.</strong></p>
<blockquote>
<p>不管是客户端还是服务器, 都需要随机数, 这样生成的密钥才不会每次都一样. 由于SSL协议中证书是静态的, 因此十分有必要引入一种随机因素来保证协商出来的密钥的随机性.<br>对于RSA密钥交换算法来说, pre-master-key本身就是一个随机数, 再加上hello消息中的随机, 三个随机数通过一个密钥导出器最终导出一个对称密钥.<br>pre master的存在在于SSL协议不信任每个主机都能产生完全随机的随机数, 如果随机数不随机, 那么pre master secret就有可能被猜出来, 那么仅适用pre master secret作为密钥就不合适了, 因此必须引入新的随机因素, 那么客户端和服务器加上pre master secret三个随机数一同生成的密钥就不容易被猜出了, 一个伪随机可能完全不随机, 可是是三个伪随机就十分接近随机了, 每增加一个自由度, 随机性增加的可不是一. </p>
</blockquote>
<h4 id="1-2-TLS-双向认证握手"><a href="#1-2-TLS-双向认证握手" class="headerlink" title="1.2 TLS 双向认证握手"></a>1.2 TLS 双向认证握手</h4><p><img src="/2021/02/13/面试汇总-网络/./08e6235892053a81603a4c3d7c7f44ad.png" alt="enter image description here"></p>
<ul>
<li>客户端发起请求, 给出协议版本号</li>
<li>客户端/服务端交换证书</li>
<li>客户端发送客户端支持的加密方案</li>
<li>服务端根据自己的情况, 选择<code>加密方案</code>, 使用客户端的公钥加密, 返回给客户端</li>
<li>客户端用自己私钥解密<code>加密方案</code>,  生成随机数(<code>对话秘钥</code>), 使用服务端的公钥加密, 发送给服务端</li>
<li>服务端使用自己的私钥解密, 解析出随机数(<code>对话秘钥</code>)</li>
</ul>
<h3 id="2-session的恢复"><a href="#2-session的恢复" class="headerlink" title="2. session的恢复"></a>2. session的恢复</h3><p>握手阶段用来建立SSL连接. 如果出于某种原因, 对话中断, 就需要重新握手. </p>
<ul>
<li>session ID: 每一次对话都有一个编号(session ID). 如果对话中断, 下次重连的时候, 只要客户端给出这个编号, 且服务器有这个编号的记录, 双方就可以重新使用已有的”对话密钥”, 而不必重新生成一把. <ul>
<li>缺点: 换个服务器就不认. </li>
</ul>
</li>
<li>session ticket: 将本次对话的主要信息, 比如对话密钥和加密方法加密, 只有服务器才能解密(应该是公钥加密). 当服务器收到session ticket以后, 解密后就不必重新生成对话密钥了. </li>
</ul>
<h3 id="3-HTTPS-对于HTTP解决了什么问题"><a href="#3-HTTPS-对于HTTP解决了什么问题" class="headerlink" title="3. HTTPS 对于HTTP解决了什么问题"></a>3. HTTPS 对于HTTP解决了什么问题</h3><ol>
<li>窃听风险(eavesdropping): 第三方可以获知通信内容. (没有对话秘钥无法解析)</li>
<li>篡改风险(tampering): 第三方可以修改通信内容.  (篡改后的数据, 无法通过对话秘钥解析)</li>
<li>冒充风险(pretending): 第三方可以冒充他人身份参与通信.  (同2)</li>
</ol>
<h3 id="4-如何保证公钥不被篡改"><a href="#4-如何保证公钥不被篡改" class="headerlink" title="4. 如何保证公钥不被篡改"></a>4. 如何保证公钥不被篡改</h3><blockquote>
<p>放入数字证书中, 数字证书是有效的, 公钥就是有效的. 数字证书由数字证书机构(CA)颁发.</p>
</blockquote>
<h3 id="5-怎么减少公钥加解密的时间"><a href="#5-怎么减少公钥加解密的时间" class="headerlink" title="5. 怎么减少公钥加解密的时间"></a>5. 怎么减少公钥加解密的时间</h3><blockquote>
<p>每一次对话(session), 客户端和服务器端都生成一个”对话密钥”（session key), 用它来加密信息. 由于”对话密钥”是对称加密, 所以运算速度非常快, 而服务器公钥只用于加密”对话密钥”本身, 这样就减少了加密运算的消耗时间.<br>然后尽量复用连接</p>
</blockquote>
<h3 id="6-HTTPS和HTTP的区别"><a href="#6-HTTPS和HTTP的区别" class="headerlink" title="6. HTTPS和HTTP的区别"></a>6. HTTPS和HTTP的区别</h3><ol>
<li>HTTPS安全, HTTP基于明文传输, 不安全</li>
<li>HTTPS性能下降, 主要体现在, 建立连接增加了tls握手, 发送接收数据需要加解密</li>
<li>端口不一样</li>
<li>SSL证书要钱</li>
</ol>
<h3 id="7-HTTP2和HTTP的区别"><a href="#7-HTTP2和HTTP的区别" class="headerlink" title="7. HTTP2和HTTP的区别"></a>7. HTTP2和HTTP的区别</h3><ul>
<li>HTTP/2 使用<code>HPACK</code>算法压缩头部信息, 消除冗余数据节约带宽;</li>
<li>HTTP/2 的消息不再是<code>Header+Body</code>的形式, 而是分散为多个二进制<code>帧</code>; </li>
<li>HTTP/2 使用虚拟的<code>流</code>传输消息, 解决了困扰多年的<code>队头阻塞</code>问题, 同时实现了<code>多路复用</code>, 提高连接的利用率; (怎么保证有序: 帧里面有流标识符. 还有流ID)</li>
<li>HTTP/2 也增强了安全性, 要求至少是 TLS1.2, 而且禁用了很多不安全的密码套件. </li>
</ul>
<h3 id="8-队头阻塞问题"><a href="#8-队头阻塞问题" class="headerlink" title="8. 队头阻塞问题"></a>8. 队头阻塞问题</h3><ul>
<li>TCP队头阻塞: 上一个报文没有成功发送出去, 后续的报文都会被阻塞</li>
<li>HTTP队头阻塞: 服务端按照请求发送的顺序返回响应（FIFO），原因很简单，HTTP请求和响应并没有序号标识，无法将乱序的响应与请求关联起来。</li>
</ul>
<h2 id="last-参考资料"><a href="#last-参考资料" class="headerlink" title="last. 参考资料"></a>last. 参考资料</h2><ul>
<li><a href="http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html" target="_blank" rel="noopener">数字签名是什么？</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html" target="_blank" rel="noopener">SSL/TLS协议运行机制的概述</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html" target="_blank" rel="noopener">图解SSL/TLS协议</a></li>
<li><a href="https://developer.aliyun.com/article/726414" target="_blank" rel="noopener">HTTPS双向认证研究</a></li>
</ul>

      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/面试/" rel="tag"># 面试</a>
          
            <a href="/tags/网络/" rel="tag"># 网络</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/02/13/面试汇总-数据库/" rel="next" title="面试汇总-数据库">
                <i class="fa fa-chevron-left"></i> 面试汇总-数据库
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/02/18/面试汇总-操作系统/" rel="prev" title="面试汇总-操作系统">
                面试汇总-操作系统 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/default.png" alt="flyfish">
            
              <p class="site-author-name" itemprop="name">flyfish</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">31</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一-TCP协议"><span class="nav-text">一. TCP协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-三次握手"><span class="nav-text">1. 三次握手</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-四次挥手"><span class="nav-text">2. 四次挥手</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-为什么是三次握手和四次挥手？"><span class="nav-text">3. 为什么是三次握手和四次挥手？</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-为什么是三次握手？"><span class="nav-text">3.1 为什么是三次握手？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-为什么是四次挥手？"><span class="nav-text">3.2 为什么是四次挥手？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-深入理解TCP连接的释放"><span class="nav-text">4. 深入理解TCP连接的释放</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-连接释放详细过程"><span class="nav-text">4.1 连接释放详细过程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-TCP连接中出现的各种状态"><span class="nav-text">5. TCP连接中出现的各种状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-TCP和UDP的区别"><span class="nav-text">6. TCP和UDP的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-TCP如何保证可靠性"><span class="nav-text">7. TCP如何保证可靠性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-慢启动-拥塞避免"><span class="nav-text">8. 慢启动, 拥塞避免</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-快重传和快恢复"><span class="nav-text">9. 快重传和快恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-1-快重传"><span class="nav-text">9.1 快重传</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-2-快恢复"><span class="nav-text">9.2 快恢复</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-为什么需要TIME-WAIT状态"><span class="nav-text">10. 为什么需要TIME_WAIT状态</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二-HTTP协议"><span class="nav-text">二. HTTP协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-HTTPS-TLS的握手过程"><span class="nav-text">1. HTTPS TLS的握手过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-TLS-单行认证握手"><span class="nav-text">1.1 TLS 单行认证握手</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-为什么需要三个随机数"><span class="nav-text">1.2 为什么需要三个随机数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-TLS-双向认证握手"><span class="nav-text">1.2 TLS 双向认证握手</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-session的恢复"><span class="nav-text">2. session的恢复</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-HTTPS-对于HTTP解决了什么问题"><span class="nav-text">3. HTTPS 对于HTTP解决了什么问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-如何保证公钥不被篡改"><span class="nav-text">4. 如何保证公钥不被篡改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-怎么减少公钥加解密的时间"><span class="nav-text">5. 怎么减少公钥加解密的时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-HTTPS和HTTP的区别"><span class="nav-text">6. HTTPS和HTTP的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-HTTP2和HTTP的区别"><span class="nav-text">7. HTTP2和HTTP的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-队头阻塞问题"><span class="nav-text">8. 队头阻塞问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#last-参考资料"><span class="nav-text">last. 参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">flyfish</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.5.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.5.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.5.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  



  










  





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
